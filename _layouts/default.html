<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page.title | default: site.title }}</title>
    <style>
      body { max-width: 760px; margin: 2rem auto; padding: 0 1rem; line-height: 1.6; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
      img { max-width: 100%; height: auto; }
      pre, code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
      
      /* Language Toggle Styles */
      .language-toggle {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        align-items: center;
      }
      .toggle-label {
        font-size: 0.9em;
        color: #666;
      }
      .toggle-switch {
        display: inline-flex;
        align-items: center;
        background-color: #e0e0e0;
        border-radius: 20px;
        padding: 2px;
        cursor: pointer;
        user-select: none;
        width: 60px;
        height: 28px;
      }
      .toggle-switch.active {
        background-color: #4CAF50;
      }
      .toggle-slider {
        background-color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        transition: transform 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .toggle-switch.active .toggle-slider {
        transform: translateX(32px);
      }
      .toggle-lang-en, .toggle-lang-ja {
        position: absolute;
        font-size: 0.75em;
        font-weight: bold;
      }
      .toggle-lang-en {
        left: 8px;
        color: #666;
      }
      .toggle-switch.active .toggle-lang-en {
        color: white;
      }
      .toggle-lang-ja {
        right: 6px;
        color: white;
      }
      .toggle-switch.active .toggle-lang-ja {
        color: #4CAF50;
      }
      
      .content-en, .content-ja {
        display: none;
      }
      .content-en.active {
        display: block;
      }
    </style>
  </head>
  <body data-has-japanese="{% if page.has_japanese %}true{% else %}false{% endif %}">
    <div class="language-toggle">
      <span class="toggle-label">Language:</span>
      <div class="toggle-switch" id="languageToggle">
        <span class="toggle-lang-en">EN</span>
        <span class="toggle-lang-ja">日本語</span>
        <div class="toggle-slider"></div>
      </div>
    </div>
    
    <div class="content-en active" id="contentEn">
      {{ content }}
    </div>
    <div class="content-ja" id="contentJa">
      <!-- Japanese content will be loaded here -->
    </div>

    <script>
      const toggle = document.getElementById('languageToggle');
      const contentEn = document.getElementById('contentEn');
      const contentJa = document.getElementById('contentJa');
      const body = document.body;
      const hasJapanese = body.getAttribute('data-has-japanese') === 'true';
      const pageUrl = window.location.pathname;
      
      // Function to load Japanese content
      async function loadJapaneseContent() {
        if (!hasJapanese) return;
        
        try {
          const jaUrl = pageUrl.replace(/\/$/, '') + '/index-ja';
          let response = await fetch(jaUrl);
          
          if (response.ok) {
            const html = await response.text();
            // Extract just the content (remove front matter)
            const contentStart = html.indexOf('<style>');
            if (contentStart !== -1) {
              contentJa.innerHTML = html.substring(contentStart);
            } else {
              contentJa.innerHTML = html;
            }
          }
        } catch (err) {
          console.log('Japanese content not available');
        }
      }
      
      // Load Japanese content on page load
      loadJapaneseContent();
      
      // Load saved language preference
      const savedLang = localStorage.getItem('language') || 'en';
      if (savedLang === 'ja' && hasJapanese) {
        toggle.classList.add('active');
        contentEn.classList.remove('active');
        contentJa.classList.add('active');
      }
      
      toggle.addEventListener('click', function() {
        if (!hasJapanese) return;
        
        toggle.classList.toggle('active');
        contentEn.classList.toggle('active');
        contentJa.classList.toggle('active');
        
        const lang = toggle.classList.contains('active') ? 'ja' : 'en';
        localStorage.setItem('language', lang);
      });
    </script>
  </body>
</html>